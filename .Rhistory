, 'GarageArea'
, 'SaleCondition'
, 'FirstFlrSF'
, 'SecondFlrSF'
, 'OverallQual'
, 'SalePrice'
, 'MoSold'
, 'YrSold')
knitr::kable(matrix(c(colsofinterest[2:21],""),ncol = 3,byrow = F), caption = "Variables of interest")
unique(SampleFrame$LotConfig)
SampleFrame$CornerLot <- ifelse(SampleFrame$LotConfig == "Corner",1,0)
SampleFrame$CulDSac <- ifelse(SampleFrame$LotConfig == "CulDSac",1,0)
SampleFrame$Frontal2 <- ifelse(SampleFrame$LotConfig == "FR2",1,0)
SampleFrame$Frontal3 <- ifelse(SampleFrame$LotConfig == "F3",1,0)
SampleFrame$CornerLot <- ifelse(SampleFrame$LotConfig == "Corner",1,0)
SampleFrame$CulDSac <- ifelse(SampleFrame$LotConfig == "CulDSac",1,0)
SampleFrame$Frontal2 <- ifelse(SampleFrame$LotConfig == "FR2",1,0)
SampleFrame$Frontal3 <- ifelse(SampleFrame$LotConfig == "F3",1,0)
levels(SampleFrame$CornerLot)
SampleFrame$CornerLot <- as.factor(ifelse(SampleFrame$LotConfig == "Corner",1,0))
levels(SampleFrame$CornerLot)
unique(SampleFrame$BldgType)
ampleFrame$TwnhsE <- ifelse(SampleFrame$BldgType == "TwnhsE",1,0)
SampleFrame$TwnhsE <- ifelse(SampleFrame$BldgType == "TwnhsE",1,0)
SampleFrame$Twnhs <- ifelse(SampleFrame$BldgType == "Twnhs", 1,0)
SampleFrame$Duplex <- ifelse(SampleFrame$BldgType == "Duplex", 1,0)
SampleFrame$fam2 <- ifelse(SampleFrame$BldgType == "2famCon",1,0)
unique(SampleFrame$SaleCondition)
unique(SampleFrame$HouseStyle)
colsofinterest <- c('SID'
,'LotArea'
, 'LotConfig'
, 'Neighborhood'
, 'BldgType'
, 'OverallCond'
, 'YearRemodel'
, 'TotalBsmtSF'
, 'GrLivArea'
, 'BsmtFullBath'
, 'BsmtHalfBath'
, 'FullBath'
, 'HalfBath'
, 'BedroomAbvGr'
, 'KitchenQual'
, 'TotRmsAbvGrd'
, 'GarageArea'
, 'MoSold'
, 'YrSold'
, 'SaleCondition'
, 'FirstFlrSF'
, 'SecondFlrSF'
, 'OverallQual'
, 'SalePrice')
knitr::kable(matrix(c(colsofinterest[2:22],""),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:22],""),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:23],""),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:23],""),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:23]),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:23],"",""),ncol = 3,byrow = F), caption = "Variables of interest")
colsofinterest <- c('SID'
,'LotArea'
, 'LotConfig'
, 'Neighborhood'
, 'BldgType'
, 'OverallCond'
, 'YearRemodel'
, 'TotalBsmtSF'
, 'GrLivArea'
, 'BsmtFullBath'
, 'BsmtHalfBath'
, 'FullBath'
, 'HalfBath'
, 'BedroomAbvGr'
, 'KitchenQual'
, 'TotRmsAbvGrd'
, 'GarageArea'
, 'MoSold'
, 'YrSold'
, 'SaleCondition'
, 'FirstFlrSF'
, 'SecondFlrSF'
, 'OverallQual'
, 'SalePrice')
knitr::kable(matrix(c(colsofinterest[2:22],"",""),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:22],"","",""),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:23],"","",""),ncol = 3,byrow = F), caption = "Variables of interest")
knitr::kable(matrix(c(colsofinterest[2:23],"",""),ncol = 3,byrow = F), caption = "Variables of interest")
# Get sample frame.
SampleFrame <- ames %>%
dplyr::filter(DropCondition == '99: Eligible Sample') %>%
dplyr::select_(.dots = colsofinterest)
SampleFrame <- SampleFrame %>%
dplyr::mutate(TotalBath = BsmtFullBath + BsmtHalfBath + FullBath + HalfBath) %>%
dplyr::mutate(TotalSQFT = TotalBsmtSF + FirstFlrSF + SecondFlrSF) %>%
dplyr::mutate(SQFTNoBsmt = FirstFlrSF + SecondFlrSF) %>%
dplyr::mutate(QualityIndex = OverallQual*OverallCond) %>%
dplyr::mutate(u = runif(nrow(SampleFrame)))
# -----------------------------Grouping Neighborhoods-----------------------------------------------
NeighborhoodGrps <- SampleFrame %>%
dplyr:: select(Neighborhood,SalePrice,TotalSQFT) %>%
dplyr::group_by(Neighborhood) %>%
dplyr::summarise(TotalSalePrice = sum(SalePrice), Total.SQFT = sum(TotalSQFT),PricePerSqFt = TotalSalePrice/Total.SQFT)
Less60Neigh <- NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 60)]
Bet60_70 <-  NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 70 & NeighborhoodGrps$PricePerSqFt > 60 )]
Bet70_80 <-  NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 80 & NeighborhoodGrps$PricePerSqFt > 70 )]
Bet80_90 <-   NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 90 & NeighborhoodGrps$PricePerSqFt > 80)]
Greater_90 <-   NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt > 90)]
SampleFrame$Tier1 <- ifelse(SampleFrame$Neighborhood %in% Less60Neigh,1,0)
SampleFrame$Tier2 <- ifelse(SampleFrame$Neighborhood %in% Bet60_70,1,0)
SampleFrame$Tier3 <- ifelse(SampleFrame$Neighborhood %in% Bet70_80, 1,0)
SampleFrame$Tier4 <- ifelse(SampleFrame$Neighborhood %in% Bet80_90, 1,0)
SampleFrame$Tier5 <- ifelse(SampleFrame$Neighborhood %in% Greater_90, 1,0)
tierdf <- data.frame(Tier = c(1,2,3,4,5), `Price per sq.ft` = c("<= 60", "> 60 and <= 70", "> 70 and <= 80", "> 80 and <= 90", " > 90"))
#-------------------------------------------------------------------------------------------------------
#------------------------------Creating indicator variables --------------------------------------------
# IV for LotConfig, base Inside lot
SampleFrame$CornerLot <- ifelse(SampleFrame$LotConfig == "Corner",1,0)
SampleFrame$CulDSac <- ifelse(SampleFrame$LotConfig == "CulDSac",1,0)
SampleFrame$Frontal2 <- ifelse(SampleFrame$LotConfig == "FR2",1,0)
SampleFrame$Frontal3 <- ifelse(SampleFrame$LotConfig == "F3",1,0)
# IV for BlgType, base "1Fam"
SampleFrame$TwnhsE <- ifelse(SampleFrame$BldgType == "TwnhsE",1,0)
SampleFrame$Twnhs <- ifelse(SampleFrame$BldgType == "Twnhs", 1,0)
SampleFrame$Duplex <- ifelse(SampleFrame$BldgType == "Duplex", 1,0)
SampleFrame$fam2 <- ifelse(SampleFrame$BldgType == "2famCon",1,0)
# IV for SaleCondition, bae "Normal"
SampleFrame$PartialSaleCond <- ifelse(SampleFrame$SaleCondition == "Partial",1,0)
# --------------------------------------------------------------------------------------------------------------
# training set
#train <- dplyr::sample_n(SampleFrame,size = trainPercent*nrow(SampleFrame), replace = F,set.seed(2000))
train <- subset(SampleFrame , u < 0.7)
train <- train %>% dplyr::arrange(SID)
# Validation set
#Validation <- dplyr::sample_n(SampleFrame,size = (1-trainPercent)*nrow(SampleFrame), replace = F, set.seed(2000))
Validation <- subset(SampleFrame, u > 0.7)
Validation <- Validation %>% dplyr::arrange(SID)
# Check row counts
df <- cbind(Data = c("Training set", "Validation set","Total"), Samples = c(nrow(train),nrow(Validation),nrow(train) + nrow(Validation)))
knitr::kable(df,align = c("l","r"),caption = "Training and Validation sampling")
unique(SampleFrame$KitchenQual)
knitr::kable(tierdf, caption = "Neighborhood tiers,base category > 90")
knitr::kable(Lotconfigdf, caption = "Lot configuration indicator variables; base category: Inside Lot")
# Cleanly show the columns of interest in pdf. Making the colsofinterest as matrix for easy printing
# printing on pdf
knitr::kable(matrix(c(colsofinterest[2:23],"",""),ncol = 3,byrow = F), caption = "Predictors of interest")
tierdf <- data.frame(Tier = c(1,2,3,4), `Price per sq.ft` = c("<= 60", "> 60 and <= 70", "> 70 and <= 80", "> 80 and <= 90"))
Lotconfigdf <- data.frame(Indicator = c("CornerLot", "CulDSac", "Frontal2", "Frontal3"), Description = c("Corner lot", "CulDSac Lot", "2 frontal lot", "3 frontal lot") )
Bldgtypedf <- data.frame(Indicator = c("TwnhsE","Twnhs","Duplex","fam2"),Decription = c("Townhouse", "Twin house", "Duplex", "2 family conversion"))
KitchenQualdf <- data.frame(Indicator = c("KTA", "KGD", "KEx", "KFa"),Decription = c("Typical/Average", "Good", "Excellent", "Fair"))
knitr::kable(tierdf, caption = "Neighborhood tiers,base category > 90")
knitr::kable(Lotconfigdf, caption = "Lot configuration indicator variables; base category: Inside Lot")
knitr::kable(Bldgtypedf, caption = "Building type indicator variables; base category: single family")
knitr::kable(KitchenQualdf, caption = "Kitchen Quality indicator variables; base category: poor")
train <- train %>% dplyr::arrange(SID) %>%
dplyr::select(Predictors)
Predictors <- c('LotArea'
,'YearRemodel'
, 'TotalBsmtST'
, 'GrLivArea'
, 'TotalBath'
, 'TotalSQFT'
, 'QualityIndex'
, 'TotRmsAbvGrd'
, 'GarageArea'
, 'YearMonthSold'
, 'Tier1'
, 'Tier2'
, 'Tier3'
, 'Tier4'
, 'Tier5'
, 'PartialSaleCond'
, 'CornerLot'
, 'CulDSac'
, 'Frontal2'
, 'Frontal3'
, 'TwnhsE'
, 'Twnhs'
, 'Duplex'
, 'fam2'
, 'KTA'
, 'KGD'
, 'KEx'
, 'KFa'
)
train <- subset(SampleFrame , u < 0.7)
train <- train %>% dplyr::arrange(SID) %>%
dplyr::select(Predictors)
knitr::opts_chunk$set(echo = F,tidy.opts=list(width.cutoff=60),tidy=TRUE)
ames <- readr::read_delim(file = 'ames_housing_data.csv', delim = ",")
# chamge from scientic notations, to restore to default options(scipen = 0)
options(scipen = 999)
library(magrittr)
LivingAreaCutoff <- 800
# Adding drop conditions varaible
# insert dummy variable to code SaleCondition being either equal to 'Normal' or 'Partial'
ames$Sale_NrmPar <- ifelse(ames$SaleCondition == 'Normal' | ames$SaleCondition == 'Partial', 1,0)
ames$DropCondition <- ifelse(ames$Zoning!='RL','01: Not LowDensityZone',
ifelse(ames$Sale_NrmPar == 0,'02: Not Normal/Partial Sale',
ifelse(ames$Street!='Pave','03: Street Not Paved',
ifelse(ames$GrLivArea <LivingAreaCutoff,'04: Less than 800 SqFt',
ifelse(ames$TotalBsmtSF <1,'05: No Basement',
ifelse(ames$GrLivArea > 4000, '06: Greater 4000 sqft living Area - Influence Points',
ifelse(ames$GarageArea > 1000, '07:Garage area greater than 1000 sqft - Influence points',
'99: Eligible Sample')
))))))
# Waterfall
waterfall <- ames %>%
dplyr::group_by(DropCondition) %>%
dplyr::summarise(counts=n())
# Print waterfall table
knitr::kable(waterfall, align = c("l", "r"),caption = "Drop waterfall")
# Define training portion of the data
trainPercent <- round(0.7,1)
# Columns of interest
colsofinterest <- c('SID'
,'LotArea'
, 'LotConfig'
, 'Neighborhood'
, 'BldgType'
, 'OverallCond'
, 'YearRemodel'
, 'TotalBsmtSF'
, 'GrLivArea'
, 'BsmtFullBath'
, 'BsmtHalfBath'
, 'FullBath'
, 'HalfBath'
, 'BedroomAbvGr'
, 'KitchenQual'
, 'TotRmsAbvGrd'
, 'GarageArea'
, 'MoSold'
, 'YrSold'
, 'SaleCondition'
, 'FirstFlrSF'
, 'SecondFlrSF'
, 'OverallQual'
, 'SalePrice')
# Cleanly show the columns of interest in pdf. Making the colsofinterest as matrix for easy printing
# printing on pdf
knitr::kable(matrix(c(colsofinterest[2:23],"",""),ncol = 3,byrow = F), caption = "Predictors of interest")
tierdf <- data.frame(Tier = c(1,2,3,4), `Price per sq.ft` = c("<= 60", "> 60 and <= 70", "> 70 and <= 80", "> 80 and <= 90"))
Lotconfigdf <- data.frame(Indicator = c("CornerLot", "CulDSac", "Frontal2", "Frontal3"), Description = c("Corner lot", "CulDSac Lot", "2 frontal lot", "3 frontal lot") )
Bldgtypedf <- data.frame(Indicator = c("TwnhsE","Twnhs","Duplex","fam2"),Decription = c("Townhouse", "Twin house", "Duplex", "2 family conversion"))
KitchenQualdf <- data.frame(Indicator = c("KTA", "KGD", "KEx", "KFa"),Decription = c("Typical/Average", "Good", "Excellent", "Fair"))
Predictors <- c('LotArea'
,'YearRemodel'
, 'TotalBsmtST'
, 'GrLivArea'
, 'TotalBath'
, 'TotalSQFT'
, 'QualityIndex'
, 'TotRmsAbvGrd'
, 'GarageArea'
, 'YearMonthSold'
, 'Tier1'
, 'Tier2'
, 'Tier3'
, 'Tier4'
, 'Tier5'
, 'PartialSaleCond'
, 'CornerLot'
, 'CulDSac'
, 'Frontal2'
, 'Frontal3'
, 'TwnhsE'
, 'Twnhs'
, 'Duplex'
, 'fam2'
, 'KTA'
, 'KGD'
, 'KEx'
, 'KFa'
)
knitr::kable(tierdf, caption = "Neighborhood tiers,base category > 90")
knitr::kable(Lotconfigdf, caption = "Lot configuration indicator variables; base category: Inside Lot")
knitr::kable(Bldgtypedf, caption = "Building type indicator variables; base category: single family")
knitr::kable(KitchenQualdf, caption = "Kitchen Quality indicator variables; base category: poor")
knitr::kable(matrix(Predictors,ncol = 4), caption = "Predictors for linear regression models")
# Get sample frame.
SampleFrame <- ames %>%
dplyr::filter(DropCondition == '99: Eligible Sample') %>%
dplyr::select_(.dots = colsofinterest)
SampleFrame <- SampleFrame %>%
dplyr::mutate(TotalBath = BsmtFullBath + BsmtHalfBath + FullBath + HalfBath) %>%
dplyr::mutate(TotalSQFT = TotalBsmtSF + FirstFlrSF + SecondFlrSF) %>%
dplyr::mutate(SQFTNoBsmt = FirstFlrSF + SecondFlrSF) %>%
dplyr::mutate(QualityIndex = OverallQual*OverallCond) %>%
dplyr::mutate(YearMonthSold = YrSold + MoSold/100) %>%
dplyr::mutate(u = runif(nrow(SampleFrame)))
# -----------------------------Grouping Neighborhoods-----------------------------------------------
NeighborhoodGrps <- SampleFrame %>%
dplyr:: select(Neighborhood,SalePrice,TotalSQFT) %>%
dplyr::group_by(Neighborhood) %>%
dplyr::summarise(TotalSalePrice = sum(SalePrice), Total.SQFT = sum(TotalSQFT),PricePerSqFt = TotalSalePrice/Total.SQFT)
Less60Neigh <- NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 60)]
Bet60_70 <-  NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 70 & NeighborhoodGrps$PricePerSqFt > 60 )]
Bet70_80 <-  NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 80 & NeighborhoodGrps$PricePerSqFt > 70 )]
Bet80_90 <-   NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 90 & NeighborhoodGrps$PricePerSqFt > 80)]
Greater_90 <-   NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt > 90)]
SampleFrame$Tier1 <- ifelse(SampleFrame$Neighborhood %in% Less60Neigh,1,0)
SampleFrame$Tier2 <- ifelse(SampleFrame$Neighborhood %in% Bet60_70,1,0)
SampleFrame$Tier3 <- ifelse(SampleFrame$Neighborhood %in% Bet70_80, 1,0)
SampleFrame$Tier4 <- ifelse(SampleFrame$Neighborhood %in% Bet80_90, 1,0)
#SampleFrame$Tier5 <- ifelse(SampleFrame$Neighborhood %in% Greater_90, 1,0)
tierdf <- data.frame(Tier = c(1,2,3,4,5), `Price per sq.ft` = c("<= 60", "> 60 and <= 70", "> 70 and <= 80", "> 80 and <= 90", " > 90"))
#-------------------------------------------------------------------------------------------------------
#------------------------------Creating indicator variables --------------------------------------------
# IV for LotConfig, base Inside lot
SampleFrame$CornerLot <- ifelse(SampleFrame$LotConfig == "Corner",1,0)
SampleFrame$CulDSac <- ifelse(SampleFrame$LotConfig == "CulDSac",1,0)
SampleFrame$Frontal2 <- ifelse(SampleFrame$LotConfig == "FR2",1,0)
SampleFrame$Frontal3 <- ifelse(SampleFrame$LotConfig == "F3",1,0)
Lotconfigdf <- data.frame(Indicator = c("CornerLot", "CulDSac", "Frontal2", "Frontal3"), Description = c("Corner lot", "CulDSac Lot", "2 frontal lot", "3 frontal lot") )
# IV for BlgType, base "1Fam"
SampleFrame$TwnhsE <- ifelse(SampleFrame$BldgType == "TwnhsE",1,0)
SampleFrame$Twnhs <- ifelse(SampleFrame$BldgType == "Twnhs", 1,0)
SampleFrame$Duplex <- ifelse(SampleFrame$BldgType == "Duplex", 1,0)
SampleFrame$fam2 <- ifelse(SampleFrame$BldgType == "2famCon",1,0)
Bldgtypedf <- data.frame(Indicator = c("TwnhsE","Twnhs","Duplex","fam2"),Decription = c("Townhouse", "Twin house", "Duplex", "2 family conversion"))
# IV for SaleCondition, bae "Normal"
SampleFrame$PartialSaleCond <- ifelse(SampleFrame$SaleCondition == "Partial",1,0)
# IV for KitchenQual
SampleFrame$KTA <- ifelse(SampleFrame$KitchenQual == "TA", 1,0)
SampleFrame$KGD <- ifelse(SampleFrame$KitchenQual == "Gd", 1,0)
SampleFrame$KEx <- ifelse(SampleFrame$KitchenQual == "Ex", 1,0)
SampleFrame$KFa <- ifelse(SampleFrame$KitchenQual == "Fa", 1,0)
KitchenQualdf <- data.frame(Indicator = c("KTA", "KGD", "KEx", "KFa"),Decription = c("Typical/Average", "Good", "Excellent", "Fair"))
# --------------------------------------------------------------------------------------------------------------
Predictors <- c('LotArea'
,'YearRemodel'
, 'TotalBsmtSF'
, 'GrLivArea'
, 'TotalBath'
, 'TotalSQFT'
, 'QualityIndex'
, 'TotRmsAbvGrd'
, 'GarageArea'
, 'YearMonthSold'
, 'Tier1'
, 'Tier2'
, 'Tier3'
, 'Tier4'
, 'PartialSaleCond'
, 'CornerLot'
, 'CulDSac'
, 'Frontal2'
, 'Frontal3'
, 'TwnhsE'
, 'Twnhs'
, 'Duplex'
, 'fam2'
, 'KTA'
, 'KGD'
, 'KEx'
, 'KFa'
)
# training set
#train <- dplyr::sample_n(SampleFrame,size = trainPercent*nrow(SampleFrame), replace = F,set.seed(2000))
train <- subset(SampleFrame , u < 0.7)
train <- train %>% dplyr::arrange(SID) %>%
dplyr::select(Predictors)
# Validation set
#Validation <- dplyr::sample_n(SampleFrame,size = (1-trainPercent)*nrow(SampleFrame), replace = F, set.seed(2000))
Validation <- subset(SampleFrame, u > 0.7)
Validation <- Validation %>% dplyr::arrange(SID) %>%
dplyr::select(Predictors)
# Check row counts
df <- cbind(Data = c("Training set", "Validation set","Total"), Samples = c(nrow(train),nrow(Validation),nrow(train) + nrow(Validation)))
knitr::kable(df,align = c("l","r"),caption = "Training and Validation sampling")
# Get sample frame.
SampleFrame <- ames %>%
dplyr::filter(DropCondition == '99: Eligible Sample') %>%
dplyr::select_(.dots = colsofinterest)
SampleFrame <- SampleFrame %>%
dplyr::mutate(TotalBath = BsmtFullBath + BsmtHalfBath + FullBath + HalfBath) %>%
dplyr::mutate(TotalSQFT = TotalBsmtSF + FirstFlrSF + SecondFlrSF) %>%
dplyr::mutate(SQFTNoBsmt = FirstFlrSF + SecondFlrSF) %>%
dplyr::mutate(QualityIndex = OverallQual*OverallCond) %>%
dplyr::mutate(YearMonthSold = YrSold + MoSold/100) %>%
dplyr::mutate(u = runif(nrow(SampleFrame)))
# -----------------------------Grouping Neighborhoods-----------------------------------------------
NeighborhoodGrps <- SampleFrame %>%
dplyr:: select(Neighborhood,SalePrice,TotalSQFT) %>%
dplyr::group_by(Neighborhood) %>%
dplyr::summarise(TotalSalePrice = sum(SalePrice), Total.SQFT = sum(TotalSQFT),PricePerSqFt = TotalSalePrice/Total.SQFT)
Less60Neigh <- NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 60)]
Bet60_70 <-  NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 70 & NeighborhoodGrps$PricePerSqFt > 60 )]
Bet70_80 <-  NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 80 & NeighborhoodGrps$PricePerSqFt > 70 )]
Bet80_90 <-   NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt <= 90 & NeighborhoodGrps$PricePerSqFt > 80)]
Greater_90 <-   NeighborhoodGrps$Neighborhood[which(NeighborhoodGrps$PricePerSqFt > 90)]
SampleFrame$Tier1 <- ifelse(SampleFrame$Neighborhood %in% Less60Neigh,1,0)
SampleFrame$Tier2 <- ifelse(SampleFrame$Neighborhood %in% Bet60_70,1,0)
SampleFrame$Tier3 <- ifelse(SampleFrame$Neighborhood %in% Bet70_80, 1,0)
SampleFrame$Tier4 <- ifelse(SampleFrame$Neighborhood %in% Bet80_90, 1,0)
#SampleFrame$Tier5 <- ifelse(SampleFrame$Neighborhood %in% Greater_90, 1,0)
tierdf <- data.frame(Tier = c(1,2,3,4,5), `Price per sq.ft` = c("<= 60", "> 60 and <= 70", "> 70 and <= 80", "> 80 and <= 90", " > 90"))
#-------------------------------------------------------------------------------------------------------
#------------------------------Creating indicator variables --------------------------------------------
# IV for LotConfig, base Inside lot
SampleFrame$CornerLot <- ifelse(SampleFrame$LotConfig == "Corner",1,0)
SampleFrame$CulDSac <- ifelse(SampleFrame$LotConfig == "CulDSac",1,0)
SampleFrame$Frontal2 <- ifelse(SampleFrame$LotConfig == "FR2",1,0)
SampleFrame$Frontal3 <- ifelse(SampleFrame$LotConfig == "F3",1,0)
Lotconfigdf <- data.frame(Indicator = c("CornerLot", "CulDSac", "Frontal2", "Frontal3"), Description = c("Corner lot", "CulDSac Lot", "2 frontal lot", "3 frontal lot") )
# IV for BlgType, base "1Fam"
SampleFrame$TwnhsE <- ifelse(SampleFrame$BldgType == "TwnhsE",1,0)
SampleFrame$Twnhs <- ifelse(SampleFrame$BldgType == "Twnhs", 1,0)
SampleFrame$Duplex <- ifelse(SampleFrame$BldgType == "Duplex", 1,0)
SampleFrame$fam2 <- ifelse(SampleFrame$BldgType == "2famCon",1,0)
Bldgtypedf <- data.frame(Indicator = c("TwnhsE","Twnhs","Duplex","fam2"),Decription = c("Townhouse", "Twin house", "Duplex", "2 family conversion"))
# IV for SaleCondition, bae "Normal"
SampleFrame$PartialSaleCond <- ifelse(SampleFrame$SaleCondition == "Partial",1,0)
# IV for KitchenQual
SampleFrame$KTA <- ifelse(SampleFrame$KitchenQual == "TA", 1,0)
SampleFrame$KGD <- ifelse(SampleFrame$KitchenQual == "Gd", 1,0)
SampleFrame$KEx <- ifelse(SampleFrame$KitchenQual == "Ex", 1,0)
SampleFrame$KFa <- ifelse(SampleFrame$KitchenQual == "Fa", 1,0)
KitchenQualdf <- data.frame(Indicator = c("KTA", "KGD", "KEx", "KFa"),Decription = c("Typical/Average", "Good", "Excellent", "Fair"))
# --------------------------------------------------------------------------------------------------------------
Predictors <- c('LotArea'
,'YearRemodel'
, 'TotalBsmtSF'
, 'GrLivArea'
, 'TotalBath'
, 'TotalSQFT'
, 'QualityIndex'
, 'TotRmsAbvGrd'
, 'GarageArea'
, 'YearMonthSold'
, 'Tier1'
, 'Tier2'
, 'Tier3'
, 'Tier4'
, 'PartialSaleCond'
, 'CornerLot'
, 'CulDSac'
, 'Frontal2'
, 'Frontal3'
, 'TwnhsE'
, 'Twnhs'
, 'Duplex'
, 'fam2'
, 'KTA'
, 'KGD'
, 'KEx'
, 'KFa'
)
# training set
#train <- dplyr::sample_n(SampleFrame,size = trainPercent*nrow(SampleFrame), replace = F,set.seed(2000))
train <- subset(SampleFrame , u < 0.7)
train <- train %>% dplyr::arrange(SID)
train.Clean <- train %>% select(Predictors)
train.Clean <- train %>% dplyr::select(Predictors)
upper.lm <- lm(data = train.Clean,SalePrice ~ .)
train.Clean <- train %>% dplyr::select(c(Predictors,'SalePrice'))
upper.lm <- lm(data = train.Clean,SalePrice ~ .)
summary(upper.lm)
plot(upper.lm$fitted.values,upper.lm$residuals)
qnorm(upper.lm$residuals)
qqnorm(upper.lm$residuals)
upper.lm$model
upper.lm$terms
summary.lm(upper.lm)
lower.lm <- lm(data = train.Clean, SalePrice ~ 1)
summary(lower.lm)
formula(upper.lm)
sqft.lm <- lm(data = train.Clean, SalePrice ~ TotalSQFT)
summary(sqft.lm)
extractAIC(upper.lm)
anova(upper.lm)
forward.lm <- MASS::stepAIC(object = lower.lm,scope = list(upper = formula(upper.lm), lower = ~1), direction = "forward")
summary.lm(forward.lm)
extractAIC(forward.lm)
library(car)
sort(vif(forward.lm), decreasing = T)
backward.lm <- MASS::stepAIC(object = upper.lm, direction = "backward")
summary.lm(backward.lm)
stepwise.lm <- MASS::stepAIC(object = sqft.lm,scope = list(upper = formula(upper.lm), lower = ~1),direction = "both")
summary(stepwise.lm)
summary(backward.lm)
summary(forward.lm)
summary(upper.lm)
BIC(forward.lm)
AIC(forward.lm)
sort(vif(forward.lm),decreasing = T)
sort(vif(backward.lm),decreasing = T)
sort(vif(stepwise.lm),decreasing = T)
junk.lm <- lm(SalePrice ~ OverallQual + OverallCond + QualityIndex + GrLivArea + TotalSQFT, data = train)
summary(junk.lm)
AIC(junk.lm)
sort(vif(junk.lm),decreasing = T)
forward.test <- predict(object = stepwise.lm, data = Validation)
summary(forward.test)
Validation <- subset(SampleFrame, u > 0.7)
Validation <- Validation %>% dplyr::arrange(SID)
forward.test <- predict(object = stepwise.lm, data = Validation)
test <- cbind(Validation$SalePrice, forward.test)
length(Validation$SalePrice)
length(forward.test)
forward.test <- predict(object = stepwise.lm, newdata = Validation)
length(forward.test)
test <- cbind(Validation$SalePrice, forward.test)
View(test)
test <- data.frame(Validation$SalePrice, forward.test)
test %>% mutate(error = Validation.SalePrice - forward.test)
test %>% dplyr::mutate(error = Validation.SalePrice - forward.test)
View(test)
test <- test %>% dplyr::mutate(error = Validation.SalePrice - forward.test)
mean(abs(test))
mean(abs(test$error))
mean(abs(test$error))/ mean(test$Validation.SalePrice)
