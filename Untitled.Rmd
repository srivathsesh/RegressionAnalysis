---
title: 'Assignment 1: Getting know your Data'
author: "Sri Seshadri"
date: "6/22/2017"
output:
  pdf_document: 
    fig_caption: yes
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
ames <- readr::read_delim(file = 'ames_housing_data.csv', delim = ",")
# chamge from scientic notations, to restore to default options(scipen = 0)
options(scipen = 999)
```

## Introduction

This report discusses the Ames, Iowa housing data set, its quality and observations from Exploratory Data Analysis (EDA). EDA was used to identify potential predictor variables that can be used for predicting value of a "typical" home. 

## Sample Definition

It is assumed that typical home buyers are those that move from apartments to single family or town homes. Also apartments are less likely to be sold to individuals as they remain holdings of owners for rental income. Single family and town homes belong to "Residential Low density" (RL) zoning classification in the city of Ames. Data belonging to only to the RL zone is considered for this analysis. There are a total of `r nrow(ames)` data points, out of which the rows belonging to the following zoning classifications are not sampled. The sampled data however has few two-family conversion and duplex houses, which are not removed from the sample at this time. 

```{r, warning=FALSE,message=FALSE}
library(magrittr)
waterfall <- ames %>%
  dplyr::filter(Zoning != 'RL') %>% 
  dplyr::group_by(Zoning) %>%
  dplyr::summarise(counts = n())

# Print waterfall table
knitr::kable(waterfall, align = c("l", "r"),caption = "Drop waterfall")

# sample population
SampledPop <- dplyr::filter(ames,Zoning == 'RL')
# define variables of interest from the data
colsofinterest <- c('LotArea'
, 'LotConfig'
, 'Neighborhood'
, 'HouseStyle'
, 'OverallCond'
, 'YearRemodel'
, 'TotalBsmtSF'
, 'GrLivArea'
, 'BsmtFullBath'
, 'BsmtHalfBath'
, 'FullBath'
, 'HalfBath'
, 'BedroomAbvGr'
, 'KitchenQual'
, 'TotRmsAbvGrd'
, 'GarageCars'
, 'MoSold'
, 'YrSold'
, 'SaleCondition'
, 'SalePrice')
library(dplyr)
SampleFrame <- SampledPop %>% select_(.dots = colsofinterest)

library(mosaic)
# populate table with statistics
sanitycheck <- do.call(rbind,dfapply(SampleFrame,favstats, select = is.numeric))
# format numbers in the table for mean and sd
sanitycheck$mean <- as.numeric(format(sanitycheck$mean , digits = 1, nsmall = 2))
sanitycheck$sd <- as.numeric(format(sanitycheck$sd , digits = 1, nsmall = 2))
# subset character columns from sanitycheck
sanitycheckcharacter <- dplyr::select(SampleFrame, colnames(SampleFrame[1,sapply(SampleFrame,class) == 'character']))


library(purrr)
UniqueVals <- sanitycheckcharacter %>% 
  map(unique)
#s <- data.frame(names(tst),sapply(tst,function(x){paste(x,collapse = ",")}),row.names = NULL)
Counts <- data.frame(sapply(UniqueVals,length),do.call(rbind,dfapply(sanitycheckcharacter,length,select = is.character)),do.call(rbind,dfapply(sanitycheckcharacter,n_missing,select = is.character)),row.names = names(UniqueVals))
colnames(Counts) <- c( "# Unique", "n","missing")
```

## Data cleaning and Sanity check

From the Ames, Iowa housing dataset's dictionary (see Apendix) and based on some preliminary EDA the variables listed in Table 2 and Table 3 were chosen to be important for furhter analysis. The dataset is fairy clean and there are `r sum(sum(sanitycheck$missing),sum(Counts$missing)) ` points that are missing. Table 2 shows the summary statisics of the numeric variables and it is noted that statistics are within reasonable bounds and appear to be in the units of measure as described in the data dictionary. 
  Table 3 shows the chosen categorical (Nominal) variables and their unique number of values, sample sixe (n) and count of missing data. 4 of the 26 neighborhood are not in the sample frame chosen.  

```{r pressure, echo=FALSE}
knitr::kable(sanitycheck, caption = "Data sanity check for numeric variables") 
knitr::kable(Counts, caption = "Data sanity check for nominal variables",align = c("l","r","r","r")) 
```

## Initial Exploratory Data Analysis (EDA)

For ease of performing exploratory data analysis using the R software, a unique identification number for each row is added as a variable to the dataset. The year sold (YrSold) and month sold (MoSold) are combined into one variable as yrmonth for example January 2001 is coded as 2001.01. The data is then arranged in chronological order by "Neigborhood". The sales proce of properties are right skewed as seen in Figure 1. It is hypothesized that values in some neighborhoods are higher relative to others.

```{r, echo= FALSE, warning=FALSE, message=FALSE, out.width=c('250px','200px'),fig.show='hold',fig.cap="Control Chart and Histogram"}
# Add attribute columns for exploring purposes
SampleFrame<- SampleFrame %>% 
  mutate(ID = 1:nrow(SampleFrame)) %>% 
  mutate(yrmonth = YrSold + MoSold/100) %>% 
  mutate(logSalePrice = log10(SalePrice)) %>% 
  arrange(Neighborhood,yrmonth)

# Explore time series
#source('Multiplot.R')
library(qicharts)
library(ggplot2)

controlchart <- qic(data = SampleFrame, y = SalePrice, x = ID, chart = "i", xlab = "ID", ylab = "SalePrice")
ggplot(SampleFrame) + geom_histogram(mapping = aes(x = SalePrice),binwidth = 10000)+theme_bw() + ggtitle("Histogram SalesPrice")

```
\pagebreak


It is evident from Figure 2 that the sale price that were above the upper control limit on the control chart were more from Stone Brook, Northridge Heights and Northridge than the rest of the neighborhoods. Also it is seen that the some neighborhoods have more sales than others (Figure 3). They may be either new housing developments or likey to have a floating population.  \newline  
\newline  

```{r,echo= FALSE, warning=FALSE, message=FALSE, fig.cap="Boxplot of Sales by Neighborhood",fig.height= 3}
ggplot(data = SampleFrame,mapping = aes(x = Neighborhood, y = SalePrice, color = Neighborhood)) + geom_boxplot(orientation = 'h') + geom_point() + geom_jitter(position = position_jitter(width = 0.1, height = 0.1)) + coord_flip() +  theme_classic() + theme(legend.position = "none") + geom_hline(yintercept = 300000)
```



```{r, fig.cap="Frequency of Sales by Neighborhood", fig.height= 3}
ggplot(data = SampleFrame) + geom_bar(mapping = aes(x = Neighborhood, fill = Neighborhood)) + coord_flip() + theme_bw() + theme(legend.position = "none")
```

\pagebreak

The sale condition has a pronounced effect on the sale price (see Figure 4). It is seen that homes that were not fully completed when last assessed were expensive. This could mean that they were newly constructed homes that were priced higher than the older ones. This leads us to hypothesize that year built or remodelled would have similar effect on the sales price. Also it would be interesting to see if new constructions are from a specific neighborhood and how do they compare with mature neighborhoods, which we'll explore in the next section.  \newline

 
```{r,echo= FALSE, warning=FALSE, message=FALSE,fig.cap= "Sales by Sale condition", fig.height= 3}
ggplot(data = SampleFrame,mapping = aes(x = SaleCondition, y = SalePrice, color = SaleCondition)) + geom_boxplot(orientation = 'h') + geom_point() + geom_jitter(position = position_jitter(width = 0.1, height = 0.1)) + coord_flip() +  theme_classic() + theme(legend.position = "none")
```

  
  Homes with excellent kitchen quality have on an average higher sale price, as seen in Figure 5.  
  
  
```{r,echo= FALSE, warning=FALSE, message=FALSE,fig.cap="Sale price by kitchen quality assesment", fig.height= 3}
ggplot(data = SampleFrame,mapping = aes(x = KitchenQual, y = SalePrice, color = KitchenQual)) + geom_boxplot(orientation = 'h') + geom_point() + geom_jitter(position = position_jitter(width = 0.1, height = 0.1)) + coord_flip() +  theme_classic() + theme(legend.position = "none")
```  


\pagebreak  

 From Figure 6, we can infer that there are more style of houses vailable for sale in lots in the inside of a community than Corners, Cul-de-sac or more frontage lots. Also, Cul-de-sac and 3 frontal properties are values more compared to the test of the lots (see Figure 7). 
 \newline
 
 
```{r,echo= FALSE, warning=FALSE, message=FALSE,fig.cap="Sale price by lot configuration and style", fig.height= 4}
ggplot(data = SampleFrame, mapping = aes(y = SalePrice, x = HouseStyle, fill = HouseStyle)) + geom_boxplot(alpha = 0.25) + coord_flip() + facet_wrap(~LotConfig)
```  

```{r,echo= FALSE, warning=FALSE, message=FALSE,fig.cap="Probability density of Sale price by lot configuration", fig.height= 2}
ggplot(data = SampleFrame, mapping = aes(x = SalePrice, color = LotConfig, fill = LotConfig)) + geom_density(alpha = 0.25) + theme_classic()
```


